<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/base :: html}">
<head>
    <th:block th:fragment="additional-head">
        <title>Grant Access - ChatCraft Auth</title>
    </th:block>
</head>
<body>
    <th:block th:fragment="content">
        <div class="auth-card">
            <div class="auth-card-header">
                <h1>Grant Access</h1>
                <p th:text="'Allow ' + (${clientName} ?: 'the application') + ' to access your account?'">
                    Allow the application to access your account?
                </p>
            </div>

            <!-- Client/Tenant Info -->
            <div th:if="${tenantName}" class="tenant-info">
                <h3 th:text="${tenantName}">Client Name</h3>
                <p th:if="${tenantDomain}" th:text="'Domain: ' + ${tenantDomain}">Domain: client.domain</p>
            </div>

            <!-- Consent Form -->
            <form th:action="@{/oauth2/authorize}" method="post">
                <!-- CSRF Token -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                
                <!-- OAuth2 parameters -->
                <input type="hidden" name="client_id" th:value="${clientId}"/>
                <input type="hidden" name="state" th:value="${state}"/>

                <!-- Scopes Section -->
                <div class="form-group" th:if="${requestedScopes}">
                    <h3 class="text-primary mb-3">Requested Permissions</h3>
                    <div class="scopes-list">
                        <div th:each="scope : ${requestedScopes}" class="scope-item mb-2">
                            <label class="d-flex align-items-center">
                                <input type="checkbox" 
                                       name="scope" 
                                       th:value="${scope}" 
                                       checked 
                                       class="mr-2">
                                <div>
                                    <strong th:text="${scope}">Scope name</strong>
                                    <br>
                                    <small class="text-muted" th:text="${@scopeDescriptionService.getDescription(scope)}">
                                        <span th:switch="${scope}">
                                            <span th:case="'openid'">Access your identity information</span>
                                            <span th:case="'profile'">Access your profile information</span>
                                            <span th:case="'documents:read'">Read your documents</span>
                                            <span th:case="'documents:write'">Manage your documents</span>
                                            <span th:case="'chat:access'">Access chat functionality</span>
                                            <span th:case="*" th:text="'Access ' + ${scope}">Access permission</span>
                                        </span>
                                    </small>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Warning Message -->
                <div class="alert alert-warning">
                    <strong>Important:</strong> By granting access, you allow this application to perform actions on your behalf using the selected permissions.
                </div>

                <!-- Action Buttons -->
                <div class="d-flex justify-content-between">
                    <button type="submit" name="action" value="deny" class="btn btn-secondary">
                        Deny Access
                    </button>
                    <button type="submit" name="action" value="approve" class="btn btn-primary">
                        Grant Access
                    </button>
                </div>
            </form>

            <!-- Additional Info -->
            <div class="text-center mt-4">
                <p class="text-muted">
                    <small>
                        You can revoke access at any time from your account settings.
                    </small>
                </p>
            </div>
        </div>
    </th:block>

    <th:block th:fragment="additional-scripts">
        <style>
            .scope-item {
                background: var(--light-gray);
                border-radius: 8px;
                padding: 1rem;
                border: 1px solid var(--border-color);
            }
            
            .scope-item input[type="checkbox"] {
                margin-right: 0.75rem;
                transform: scale(1.2);
            }
            
            .scopes-list {
                max-height: 300px;
                overflow-y: auto;
            }
        </style>
    </th:block>
</body>
</html>