server:
  port: 8080

logging:
  pattern:
    console: "%green(%d{yyyy-MM-dd HH:mm:ss}) %yellow([%t]) %blue(%-5level) %magenta(%logger{36}) - %msg%n"
  level:
    org.springframework.web: DEBUG
    org.springframework.cloud.gateway: TRACE
    reactor.netty: DEBUG

spring:
  banner:
    location: classpath:banner.txt
  application:
    name: gateway-service
  threads:
    virtual:
      enabled: true
  cloud:
    gateway:
      # Reactive Spring Cloud Gateway configuration
      server:
        webflux:
          globalcors:
            cors-configurations:
              '[/**]':
                  allowedOriginPatterns: "http://localhost:4200,http://127.0.0.1:4200"
                  allowedMethods: "GET, POST, PUT, DELETE, OPTIONS, PATCH"
                  allowedHeaders: "*"
                  exposedHeaders: "Authorization, Content-Type, Cache-Control, X-Requested-With, x-request-id, Location, Content-Disposition"
                  allowCredentials: true
            add-to-simple-url-handler-mapping: true
          routes:
              # Onboarding Service Routes
              - id: onboarding-documents
                uri: http://localhost:8001
                predicates:
                    - Path=/api/v1/documents/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: onboarding-categorization
                uri: http://localhost:8001
                predicates:
                    - Path=/api/v1/categories/**,/api/v1/tags/**,/api/v1/analytics/**,/api/v1/setup/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: onboarding-logo
                uri: http://localhost:8001
                predicates:
                  - Path=/api/v1/settings-logo/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: onboarding-websites
                uri: http://localhost:8001
                predicates:
                  - Path=/api/v1/websites/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: onboarding-ingestions
                uri: http://localhost:8001
                predicates:
                  - Path=/api/v1/ingestions/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: onboarding-widgets
                uri: http://localhost:8001
                predicates:
                  - Path=/api/v1/widget/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              # Auth Service Business Routes
              - id: auth-tenants
                uri: http://localhost:9002
                predicates:
                    - Path=/api/v1/tenants/**
                filters:
                  - RewritePath=/api/v1/tenants/(?<segment>.*),/auth/api/v1/tenants/$\{segment}
                  - DedupeResponseHeader=Access-Control-Allow-Origin Access-Control-Allow-Credentials Access-Control-Allow-Headers Access-Control-Allow-Methods Access-Control-Expose-Headers

              - id: auth-users
                uri: http://localhost:9002
                predicates:
                    - Path=/api/v1/users/**
                filters:
                  - RewritePath=/api/v1/users/(?<segment>.*),/auth/api/v1/users/$\{segment}
                  - DedupeResponseHeader=Access-Control-Allow-Origin Access-Control-Allow-Credentials Access-Control-Allow-Headers Access-Control-Allow-Methods Access-Control-Expose-Headers

              # Billing Service Routes (extracted from onboarding)
              - id: billing-plans
                uri: http://localhost:8004
                predicates:
                    - Path=/api/v1/plans/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: billing-subscriptions
                uri: http://localhost:8004
                predicates:
                    - Path=/api/v1/subscriptions/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: billing-payments
                uri: http://localhost:8004
                predicates:
                    - Path=/api/v1/payments/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: billing-payment-methods
                uri: http://localhost:8004
                predicates:
                    - Path=/api/v1/payment-methods/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: billing-webhooks
                uri: http://localhost:8004
                predicates:
                    - Path=/api/v1/webhooks/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: billing-invoices
                uri: http://localhost:8004
                predicates:
                    - Path=/api/v1/invoices/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: billing-usage
                uri: http://localhost:8004
                predicates:
                    - Path=/api/v1/usage/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: billing-restrictions
                uri: http://localhost:8004
                predicates:
                    - Path=/api/v1/restrictions/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: billing-analytics
                uri: http://localhost:8004
                predicates:
                    - Path=/api/v1/analytics/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

                # Chat Service Routes
              - id: chat-api
                uri: http://localhost:8000
                predicates:
                    - Path=/api/v1/chat/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: chat-vectors
                uri: http://localhost:8000
                predicates:
                    - Path=/api/v1/vectors/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              # Communications Service Routes
              - id: communications-email
                uri: http://localhost:8003
                predicates:
                    - Path=/api/v1/email/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: communications-sms
                uri: http://localhost:8003
                predicates:
                    - Path=/api/v1/sms/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: communications-whatsapp
                uri: http://localhost:8003
                predicates:
                    - Path=/api/v1/whatsapp/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: communications-templates
                uri: http://localhost:8003
                predicates:
                    - Path=/api/v1/templates/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: communications-notifications
                uri: http://localhost:8003
                predicates:
                    - Path=/api/v1/notifications/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              # Workflow Service Routes
              - id: workflow-api
                uri: http://localhost:8002
                predicates:
                    - Path=/api/v1/workflows/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: workflow-executions
                uri: http://localhost:8002
                predicates:
                    - Path=/api/v1/executions/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: workflow-triggers
                uri: http://localhost:8002
                predicates:
                    - Path=/api/v1/triggers/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              # Answer Quality Service Routes
              - id: quality-feedback
                uri: http://localhost:8005
                predicates:
                    - Path=/api/v1/feedback/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: quality-admin
                uri: http://localhost:8005
                predicates:
                    - Path=/api/v1/admin/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: quality-alerts
                uri: http://localhost:8005
                predicates:
                    - Path=/api/v1/alerts/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              - id: quality-service
                uri: http://localhost:8005
                predicates:
                    - Path=/api/v1/quality/**
                filters:
                  - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,

              # Auth Service Routes
              - id: auth-api
                uri: http://localhost:9002
                predicates:
                  - Path=/auth/**
                filters:
                  - DedupeResponseHeader=Access-Control-Allow-Origin Access-Control-Allow-Credentials Access-Control-Allow-Headers Access-Control-Allow-Methods Access-Control-Expose-Headers

                # Health Check Routes
              - id: onboarding-health
                uri: http://localhost:8001
                predicates:
                    - Path=/health/onboarding
                filters:
                    - RewritePath=/health/onboarding,/health

              - id: chat-health
                uri: http://localhost:8000
                predicates:
                    - Path=/health/chat
                filters:
                    - RewritePath=/health/chat,/health

              - id: communications-health
                uri: http://localhost:8003
                predicates:
                    - Path=/health/communications
                filters:
                    - RewritePath=/health/communications,/health

              - id: workflow-health
                uri: http://localhost:8002
                predicates:
                    - Path=/health/workflow
                filters:
                    - RewritePath=/health/workflow,/health

              - id: billing-health
                uri: http://localhost:8004
                predicates:
                    - Path=/health/billing
                filters:
                    - RewritePath=/health/billing,/health

              - id: quality-health
                uri: http://localhost:8005
                predicates:
                    - Path=/health/quality
                filters:
                    - RewritePath=/health/quality,/api/v1/health

              - id: auth-health
                uri: http://localhost:8000
                predicates:
                  - Path=/auth
                filters:
                  - RewritePath=/health/auth,/auth/health